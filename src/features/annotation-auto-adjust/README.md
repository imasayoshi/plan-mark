# コメントボックス自動調整機能

## 使用方法

1. PDF表示画面のツールバーにある「🔧 自動調整」ボタンをクリック
2. 重なりが検出されている場合、ボタンに赤い点が表示される
3. ボタンクリックで自動調整が実行される
4. 調整中は「⟳ 調整中...」と表示される

## アルゴリズム

### 重なり検出

- 全てのコメントボックスペアを検査
- 矩形同士の重なり面積を計算
- リアルタイムで検知（ドラッグ移動後、新規作成後）

### 新規作成時の重なり回避

- 既存アノテーションとの重なりを事前チェック
- デフォルト位置で重なりがある場合、PDF境界配置アルゴリズムで最適位置を探索
- 新規作成時から重なりを予防

### PDF境界配置方式

- 引き出し線から各PDF境界（上・右・下・左）までの距離を計算
- 距離の近い境界から順に配置を試行
- 各境界で引き出し線に最も近い位置を最初に試行
- 重なりがある場合、その境界上で5pxずつずらして他の位置を探索
- 全てのコメントがPDF境界に接するように配置

### 手動移動との区別

- 手動移動時は重なり検知のみ（自動調整しない）
- 明示的な「自動調整」ボタン押下時のみ自動配置実行

### 制約条件

- PDFエリア境界から15px以上のマージン確保
- 最大50回の反復処理で収束
- 段階的探索（5px刻み）で最適位置を発見
