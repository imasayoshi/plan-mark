# 📐 Plan Mark

図面上での注釈・描画機能を提供するWebアプリケーション

## 📋 概要

- PDF図面に対して注釈やコメント、図形描画を行えるWebアプリケーションです。
- アノテーション（コメント）の自動配置機能に関するPoCを実施するために作成しています。

## 🚀 技術スタック

### フロントエンド

- **React** 19.1.1 - UIライブラリ
- **TypeScript** 5.9.2 - 型安全なJavaScript
- **Vite** 7.1.2 - 高速ビルドツール
- **React PDF** 9.2.1 - PDF表示・操作
- **PWA** - プログレッシブWebアプリ対応

### バックエンド

- **AWS Amplify Gen2** - フルスタックアプリケーション開発プラットフォーム
- **AWS DynamoDB** - NoSQLデータベース
- **AWS S3** - ファイルストレージ

## 🎯 主要機能

- PDF図面の表示・操作
- 注釈・コメントの追加・編集
- **アノテーション自動配置機能**（重なり回避・最適配置）
- 図形描画（矩形、円、矢印、ポリゴン）

## 🧠 アノテーション自動配置アルゴリズム

本プロジェクトの中核機能であるコメント・注釈の自動配置について詳述します。

### 📍 重なり検出アルゴリズム

**リアルタイム衝突検知**

- 全てのアノテーションペアを総当たりで検査
- 矩形領域の重なり面積を幾何学的に計算
- ドラッグ移動後・新規作成後に即座に検知
- 重なりがある場合は自動調整ボタンに視覚的インジケータ表示

### 🎯 PDF境界配置方式

**引き出し線基準の最適配置**

1. **距離計算**: 引き出し線端点から各PDF境界（上・右・下・左）までの距離を算出
2. **優先順序**: 最短距離の境界から順に配置候補を探索
3. **理想位置**: 各境界で引き出し線に最も近い位置を最初に試行
4. **段階的探索**: 重なりがある場合、5px刻みで境界上を移動して最適位置を発見
5. **境界制約**: PDF領域から15px以上のマージンを確保

### 🔄 反復調整アルゴリズム

**多重重なりの段階的解消**

- **最大反復回数**: 50回で収束保証
- **優先度決定**: 重なり面積の大きい順に処理
- **移動判定**: 各重なりペアで移動距離の小さい方を優先選択
- **収束条件**: 全ての重なりが解消された時点で処理完了

### 📐 制約条件と最適化

**配置制約**

- PDFビューア境界から最小15pxのマージン確保
- アノテーションサイズ: デフォルト150×40px
- 最小間隔: アノテーション間10px以上

**パフォーマンス最適化**

- 段階的探索: 5px刻みの効率的位置探索
- 早期終了: 有効位置発見時点で探索停止
- 境界優先: 距離順ソートによる無駄な計算の削減

### 🎨 ユーザー体験設計

**手動操作との調和**

- 手動移動時は重なり検知のみ（自動移動なし）
- 明示的な「自動調整」ボタン操作でのみ自動配置実行
- 調整中の視覚的フィードバック提供

**予防的配置**

- 新規アノテーション作成時に事前重なりチェック
- デフォルト位置で重なりがある場合、作成時点で最適位置に配置
